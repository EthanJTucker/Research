---
title: "Ethan's Project for Fall 2020"
author: "Ethan Tucker"
date: "June 26th, 2020"
output: html_document
---

ATTRIBUTION:
The data I use in this analysis were collected by Andrew Eckstrom of (?). Without this data none of the work that follows would have been possible. I also want to thank Professor Nordmoe for helping me with this project, from connecting me with the data set to all the helpful waychecks!

Potential error: Dataset does not distinguish between sections, so class tracker puts all sections together regardless of whether teaching quality and grade performance varied betweed sections.

**Fewest **



```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r Initialize, cache = TRUE}
library(readxl)
library(tidyverse)
Easy_Data <- read_excel("C:/Users/Ethan/Desktop/Research/Stats Research Math, Chemistry, and Biology Grades, Selected Courses.xlsx")
Gen_Data <- read_excel("C:/Users/Ethan/Desktop/Research/Stats Research XLS.xlsx")
set.seed(1000)
```

ISSUE WITH DATA SET: THE EASY DATA TRACKER DOES NOT DIFFERENTIATE BETWEEN TYPES OF WITHDRAWS. Email Dr. Eckstrom?
ISSUE WITH DATA SET: HARD TO DIFFERENTIATE BETWEEN DIFFERENT SECTIONS Uni



GENDATA ANALYSIS (CHEMISTRY AND MATH STUDENTS)

```{r Gen_Data Semester Numbering, cache = TRUE}
##Fix Gen_Data semester listing. We want them listed numerically from 1 to N.

Number.Semesters <- function(x) {
  x <- x %>% arrange(Semester)
  
  individual.cases <- x %>% pull(Semester)
  
  individual.cases[1]
  
    for(y in seq_along(along.with = individual.cases)){
      if(individual.cases[y] == "2010/FA"){
        individual.cases[y] <- 1}
      else if(individual.cases[y] == "2011/WI"){
        individual.cases[y] <- 2}
      else if(individual.cases[y] == "2011/SU"){
        individual.cases[y] <- 3}
      else if(individual.cases[y] == "2011/FA"){
        individual.cases[y] <- 4}
      else if(individual.cases[y] == "2012/WI"){
        individual.cases[y] <- 5}
      else if(individual.cases[y] == "2012/SU"){
        individual.cases[y] <- 6}
      else if(individual.cases[y] == "2012/FA"){
        individual.cases[y] <- 7}
      else if(individual.cases[y] == "2013/WI"){
        individual.cases[y] <- 8}
      else if(individual.cases[y] == "2013/SU"){
        individual.cases[y] <- 9}
      else if(individual.cases[y] == "2013/FA"){
        individual.cases[y] <- 10}
      else if(individual.cases[y] == "2014/WI"){
        individual.cases[y] <- 11}
      else if(individual.cases[y] == "2014/SU"){
        individual.cases[y] <- 12}
      else if(individual.cases[y] == "2014/FA"){
        individual.cases[y] <- 13}
      else if(individual.cases[y] == "2015/WI"){
        individual.cases[y] <- 14}
      else if(individual.cases[y] == "2015/SU"){
        individual.cases[y] <- 15}
      else if(individual.cases[y] == "2015/FA"){
        individual.cases[y] <- 16}
      else if(individual.cases[y] == "2016/WI"){
        individual.cases[y] <- 17}
      else if(individual.cases[y] == "2016/SU"){
        individual.cases[y] <- 18}
      else if(individual.cases[y] == "2016/FA"){
        individual.cases[y] <- 19}
      else if(individual.cases[y] == "2017/WI"){
        individual.cases[y] <- 20}
      else{stop("There was an invalid Semester name passed to Number.Semesters")}
      }
    x <- mutate(x, Term.Number = individual.cases)
    x
  }
  
Gen_Data <- Number.Semesters(Gen_Data)
```


```{r}
##Total number of professors
Profs.List <- unique(Gen_Data$`Faculty Random ID`)
(n.p <- length(Profs.List))
##Total number of students
Students.List <- unique(Gen_Data$`Student Random ID`)
(n.s <- length(Students.List))
##Total quantity of course entries
n <- length(Gen_Data$`Course Code`)
```

```{r Gen_Data.Grade.Converter} 
##This chunk creates the GPA colunmn in Gen_Data
###Following grade converter obtained and adapted from stack overflow user A5C1D2H2I1M1N2O1R2T1 on the page https://stackoverflow.com/questions/22746508/r-simplifying-code-to-convert-letter-grades-to-numeric-grades on 8/19/2020

convert_grades <- function(x) {
    if (x == "WS") {
        x <- 0
    } else if (x == "WF"){
      x <- 0
    } else if (x == "W"){
      x <- NA
    } else if (x == "WP"){
      x <- NA
    } else if (x == "A") {
        x <- 4
    } else if (x == "A-") {
        x <- 3.7
    } else if (x == "B+") {
        x <- 3.3
    } else if (x == "B") {
        x <- 3
    } else if (x == "B-") {
        x <- 2.7
    } else if (x == "C+") {
        x <- 2.3
    } else if (x == "C") {
        x <- 2
    } else if (x == "C-") {
        x <- 1.7
    } else if (x == "D+") {
        x <- 1.3
    } else if (x == "D") {
        x <- 1
    } else if (x == "D-") {
        x <- 0.7
    } else if (x == "F") {
        x <- 0
    } else {
        x <- NA
    }
  x <- as.double(x)
    return(x)
}


## Fix broken data points
for(i in 1:n){
  if(Gen_Data$Grade[i] == "@D"){
    Gen_Data$Grade[i] <- "D"
  }
  if(Gen_Data$Grade[i] == "@F"){
    Gen_Data$Grade[i] <- "F"
  }
}

##Apply Grade Converter
Ass.GPA <- Gen_Data$Grade
Ass.GPA [] <- sapply(Ass.GPA, convert_grades)
Gen_Data <- mutate(Gen_Data, GPA = as.double(Ass.GPA))
```

```{r Gen_Data.Reset.Button}
##Reset Button if below chunk doesn't work
Gen_Data <- select(Gen_Data,"Student Random ID":"GPA")
```

```{r, echo=FALSE}
##This chunck creates the Class Tracker, Mean GPA, and Delta columns in Gen_Data,
##Initial Conditions
f <- 1
c <- 1
cntr <- 1
prv.cntr <- 0
Gen_Data <- mutate(Gen_Data, "Class Tracker" = NA, "Mean GPA" = NA, "Delta" = NA)
Gen_Data <- arrange(arrange(arrange(Gen_Data,`Faculty Random ID`),Semester),`Course Code`)

while(is.na(Gen_Data$`Class Tracker`[n])){
if(cntr == 4332){
  break
}
  
Current.Course.Name <- Gen_Data$`Course Code`[f]
Current.Semester <- Gen_Data$Semester[f]
Current.Professor <- Gen_Data$`Faculty Random ID`[f]

while(cntr != prv.cntr ){

  if(Gen_Data$`Course Code`[c] == Current.Course.Name && Gen_Data$Semester[c] == Current.Semester && Gen_Data$`Faculty Random ID`[c] == Current.Professor){
    Gen_Data$`Class Tracker`[c] <- cntr
    c <- c+1
    }
  
  else{
    ##Calculate class mean GPA and individual student Delta's
    Class.GPAS <- rep(0,c-f)
    for(z in 2:(c-f)){
      Class.GPAS[z] <- as.double(Gen_Data$GPA[z-1+f])
    }
     class.mean.gpa <- mean(Class.GPAS, na.rm = TRUE)
    
    for(k in f:(c-1)){
      Gen_Data$`Mean GPA`[k] <- class.mean.gpa
      Gen_Data$`Delta`[k] <- Gen_Data$GPA[k] - class.mean.gpa
    }
    prv.cntr <- prv.cntr + 1
  }
}

cntr <- cntr + 1

## c-f store to vector one known number of classes
f <- c
}

##There's some jank where this doesn't do the class gpa and delta for the final Class Tracker, so below I tell R to do it manually. This is aterrible coding hide your dignity. My one thought was to add a dummy row at the end of Gen_Data and delete it after the loop, because I think R is stopping the loop as soon as the final Class Tracker is assigned, and completes neither Delta nor Class Mean GPA for the final class.
```

start id 139176
end id 139233

```{r}
##Fix final class NEEDS UPDATE WITH BIO STUDENTS
f <- 139176
l <- 139233
k <- l - (f-1)
Gen_Data <- arrange(arrange(arrange(Gen_Data,`Faculty Random ID`),Semester),`Course Code`)
Class.GPAS2 <- rep(0,k)
for(i in f:l){
  Class.GPAS2[i-(f-1)] <- as.double(Gen_Data$GPA[i])
  Gen_Data$`Class Tracker`[i] <- 4332 ##CHANGE
}
class.mean.gpa <- mean(Class.GPAS2,na.rm = TRUE)
for(i in f:l){
  Gen_Data$`Mean GPA`[i] <- class.mean.gpa
  Gen_Data$Delta[i] <- Gen_Data$GPA[i] - class.mean.gpa
}

```




```{r Initialize.Points.Tracker}
##Creates Points Tracker
Points.Tracker <- data.frame(Prof.Type = NA, Professors = Profs.List, First.Math.Points = 0, First.Chem.Points = 0, First.Bio.Points = 0, First.Withdraws = 0,  Total.Math.Points = 0, Total.Chem.Points = 0, Total.Bio.Points = 0,  Total.Withdraws = 0)
Points.Tracker <- arrange(Points.Tracker, `Professors`)
View(Points.Tracker)
```


```{r}
##Assigns point values to professors



```


Does the grade assigned by first Professor predict / influence future performance in major / out of major?

Does early exposure to mathematics predict / influence future performance in out of major? Vice Versa?

Do grades generally improve, worsen, or remain constant?

Do some teachers have significantly higher Withdraw rates than other professors? (p = .01)

What is the mean number of different courses a prof teaches? What is the mean number of majors a prof teaches?

```{r}
##First Course Tracker
Gen_Data <- arrange(Gen_Data)
Gen_Data <- arrange(arrange(Gen_Data,Semester),`Student Random ID`)
f <- 1
l <- 1
cntr <- 1
for(i in 1:n.s){
  ## Picks out each student's classes from Gen Data
  while(Gen_Data$`Student Random ID`[cntr] == Gen_Data$`Student Random ID`[cntr+1]){
    cntr <- cntr + 1
  }
  
  l <- cntr
  
  ##Expresses those classes as a data frame
S.Data <- Gen_Data[f:l,]
  
  
  ##Creates information about the professor to which we assign points
  z <- 1 + l - f
  
  First.Prof <- function(Department){
    m <- length(S.Data$`Student Random ID`)
  }
  
  First.Prof <- S.Data$`Faculty Random ID`[z]
  Prof.Major <- NA
  
  if(startsWith(S.Data$`Course Code`[z],"MAT")){
    Prof.Major <- "MAT"
  }
  else if(startsWith(S.Data$`Course Code`[z],"CHE")){
    Prof.Major <- "CHE"
  }
  
  for(m in 1:n.p){
    if(First.Prof == Profs.List[m]){
      Prof.Position <- m 
    }
  }
  
  
  Sort.Points.First <- function(Major.Points){
    
  }
    
  ## FIRST TEACHER MATH:   Assign math points
    
  ## FIRST TEACHER MATH:   Assign chemistry points
  
  ## FIRST TEACHER MATH:   Assign bio points
  
  ## FIRST TEACHER CHEM:   Assign chem points
  
  ## FIRST TEACHER CHEM:   Assign math points
  
  ## FIRST TEACHER CHEM:   Assign bio points
  
  ## FIRST TEACHER BIO:    Assign bio points
  
  ## FIRST TEACHER BIO:    Assign math points
  
  ## FIRST TEACHER BIO:    Assign chem points
  
  
  
  
  ## Here I check the rest of the profs, and assign them points for OUT OF MAJOR classes.
  
  ## Here I check the rest of the profs, and assign them points for IN MAJOR classes.
  
  
  
  f <- l + 1
}


```

```{r}
##Total Withdraws Tracker

```
















EASYDATA ANALYSIS (ALL THREE)


















WITH BIOLOGY STUDENTS



```{r}
##Integrate Biology Classes from Easy_Data to Gen_Data
n <- length(Easy_Data$Unique_Student_ID)
n.BIO <- 0
for(i in 1:n){
  if(startsWith(Easy_Data$SUBJ_CODE[i], "BIO")){
    n.BIO <- n.BIO + 1
  }
}
Rows.To.Remove <- rep(4,n)
for(i in 1:n){
  if(!startsWith(Easy_Data$SUBJ_CODE[i],"BIO")){
    Rows.To.Remove[i] <- i
  }
}

Pre.Bio.Data <- Easy_Data[-Rows.To.Remove,]

Pre.Bio.Data <- mutate(rename(Pre.Bio.Data, GPA = GRDE_CODE), Grade = NA)

##Inverse Grade Converter to normalize grade assignments with GenData

##Save non NA grade points as doubles
for(i in 1:length(Pre.Bio.Data$GPA)){
  
if(is.na(Pre.Bio.Data$GPA[i] == FALSE)){
  Pre.Bio.Data$GPA[i] <- as.double(Pre.Bio.Data$GPA[i])
}

}
   
for(i in 1:length(Pre.Bio.Data$Unique_Student_ID)){
  
  G <- Pre.Bio.Data$GPA[i]
  
  if(G == 0.5 || G == 1.5 || G == 2.5 || G == 3.5){
    G <- as.double(G)
    flip <- sample(0:1,1)
    if(flip == 0){
      G <- G - 0.1
    }
    else{
      G <- G + 0.1
    }
  }
  
  if(G >= 0 && G <= 4.1){
    G <- as.double(G)
  }
  
  if(is.character(G)){
  if(G == "I" || G == "W"){
    Pre.Bio.Data$Grade[i] <- "W" 
    Pre.Bio.Data$GPA[i] <- NA
  }
  if(G == "R" || G == "Z"){
   Pre.Bio.Data$Grade[i] <- "F"
   Pre.Bio.Data$GPA[i] <- 0
  }
    G <- NA
  }
  
  
  
  if(is.na(G)){
    
  }
  else if(G >= 3.9){
    Pre.Bio.Data$Grade[i] <- "A"
    Pre.Bio.Data$GPA[i] <- 4.0
  }
  else if(G >= 3.6){
    Pre.Bio.Data$Grade[i] <- "A-"
    Pre.Bio.Data$GPA[i] <- 3.7
  }
  else if(G >= 3.2){
    Pre.Bio.Data$Grade[i] <- "B+"
    Pre.Bio.Data$GPA[i] <- 3.3
  }
  else if(G >= 2.9){
    Pre.Bio.Data$Grade[i] <- "B"
    Pre.Bio.Data$GPA[i] <- 3.0
  }
  else if(G >= 2.6){
    Pre.Bio.Data$Grade[i] <- "B-"
    Pre.Bio.Data$GPA[i] <- 2.7
  }
  else if(G >= 2.2){
    Pre.Bio.Data$Grade[i] <- "C+"
    Pre.Bio.Data$GPA[i] <- 2.3
  }
  else if(G >= 1.9){
    Pre.Bio.Data$Grade[i] <- "C"
    Pre.Bio.Data$GPA[i] <- 2.0
  }
  else if(G >= 1.6){
    Pre.Bio.Data$Grade[i] <- "C-"
    Pre.Bio.Data$GPA[i] <- 1.7
  }
  else if(G >= 1.2){
    Pre.Bio.Data$Grade[i] <- "D+"
    Pre.Bio.Data$GPA[i] <- 1.3
  }
  else if(G >= 0.9){
    Pre.Bio.Data$Grade[i] <- "D"
    Pre.Bio.Data$GPA[i] <- 1.0
  }
  else if(G >= 0.6){
    Pre.Bio.Data$Grade[i] <- "D-"
    Pre.Bio.Data$GPA[i] <- 0.7
  }
  else{
    Pre.Bio.Data$Grade[i] <- "F"
    Pre.Bio.Data$GPA[i] <- 0.0
  }
}

```

```{r}
##Normalize Pre.Bio.Data Variables into useful object types
for(i in 1:length(Pre.Bio.Data$Unique_Student_ID)){
  Pre.Bio.Data$Unique_Student_ID[i] <- as.double(Pre.Bio.Data$Unique_Student_ID[i])
  Pre.Bio.Data$Unique_Instructor_ID[i] <- as.double(Pre.Bio.Data$Unique_Instructor_ID[i])
  Pre.Bio.Data$Year[i] <- as.double(Pre.Bio.Data$Year[i])
  Pre.Bio.Data$SUBJ_CODE[i] <- as.character(Pre.Bio.Data$SUBJ_CODE[i])
  Pre.Bio.Data$COURSE_NUMBER[i] <- as.double(Pre.Bio.Data$COURSE_NUMBER[i])
}

```
Issue with Data Set: Biology students stored seperately from math and chemistry students

```{r}

##Build Random ID assigner to normalize student and faculty naming with GenData

##Student Random ID Assigner

Pre.Bio.Data <- arrange(Pre.Bio.Data, `Unique_Student_ID`)

cntr <- 1
for(i in 1:length(Pre.Bio.Data$Unique_Student_ID)){
  
  if(i == 1){
    next.terms <- 0
    while(Pre.Bio.Data$Unique_Student_ID[i] == Pre.Bio.Data$Unique_Student_ID[i+next.terms]){
      next.terms <- next.terms + 1
    }
    next.terms <- next.terms - 1
    if((cntr %in% Gen_Data$`Student Random ID`) == FALSE){
      for(k in i: (i + next.terms)){
      Pre.Bio.Data$Unique_Student_ID[k] <- cntr
}
    }
    cntr <- cntr + 1
  }
  
    else if(Pre.Bio.Data$Unique_Student_ID[i] == Pre.Bio.Data$Unique_Student_ID[i-1]){
      ##Skips repeat student entry
      cntr <- cntr + 1
      
    }
    else{
     next.terms <- 0
      while(Pre.Bio.Data$Unique_Student_ID[i] == Pre.Bio.Data$Unique_Student_ID[i+next.terms]){
      next.terms <- next.terms + 1
    }
      next.terms <- next.terms - 1
    
       
      if((cntr %in% Gen_Data$`Student Random ID`) == FALSE){
        for(k in i: (i + next.terms)){
        Pre.Bio.Data$Unique_Student_ID[k] <- cntr
}
    }
      else{
        while(cntr %in% Gen_Data$`Student Random ID`){
        cntr <- cntr + 1
      }
        for(k in i: (i + next.terms)){
        Pre.Bio.Data$Unique_Student_ID[k] <- cntr
}
      
      }
      cntr <- cntr + 1
    }
    
  cntr < cntr + 1
}
```

```{r}

##Faculty Random ID Assigner
Pre.Bio.Data <- arrange(Pre.Bio.Data, `Unique_Instructor_ID`)

cntr <- as.double(1)
for(i in 1:length(Pre.Bio.Data$Unique_Instructor_ID)){
  
  if(i == 1){
    next.terms <- 0
    while(Pre.Bio.Data$Unique_Instructor_ID[i] == Pre.Bio.Data$Unique_Instructor_ID[i+next.terms]){
      next.terms <- next.terms + 1
    }
    next.terms <- next.terms - 1
    if((cntr %in% Gen_Data$`Faculty Random ID`) == FALSE){
      for(k in i: (i + next.terms)){
      Pre.Bio.Data$Unique_Instructor_ID[k] <- as.double(cntr)
}
    }
    cntr <- cntr + 1
  }
  
    else if(Pre.Bio.Data$Unique_Instructor_ID[i] == Pre.Bio.Data$Unique_Instructor_ID[i-1]){
      ##Skips repeat student entry
      cntr <- cntr + 1
      
    }
    else{
     next.terms <- 0
      while(Pre.Bio.Data$Unique_Instructor_ID[i] == Pre.Bio.Data$Unique_Instructor_ID[i+next.terms]){
      next.terms <- next.terms + 1
    }
      next.terms <- next.terms - 1
    
       
      if((cntr %in% Gen_Data$`Faculty Random ID`) == FALSE){
        for(k in i: (i + next.terms)){
        Pre.Bio.Data$Unique_Instructor_ID[k] <- as.double(cntr)
}
    }
      else{
        while(cntr %in% Gen_Data$`Faculty Random ID`){
        cntr <- cntr + 1
      }
        for(k in i: (i + next.terms)){
        Pre.Bio.Data$Unique_Instructor_ID[k] <- cntr
}
      
      }
      cntr <- cntr + 1
    }
    
  cntr < cntr + 1
}
```
Note: In Pre.Bio_Data, there were exactly 100 entries with term "Spring", out of 21538. There are no spring term entries for any of the chemistry nor math students in Gen_Data. In order to rectify this, I used a coin flip to split the spring term students between the winter and summer terms.
```{r}

##Term-inology converter; that's a pun :)
for(i in 1:length(Pre.Bio.Data$Term)){
  this.year <- Pre.Bio.Data$Year[i]
  if(Pre.Bio.Data$Term[i] == "Summer"){
    Pre.Bio.Data$Term[i] <- paste(this.year,"/","SU",sep = "")
  }
  if(Pre.Bio.Data$Term[i] == "Winter"){
    Pre.Bio.Data$Term[i] <- paste(this.year,"/","WI",sep = "")
  }
  if(Pre.Bio.Data$Term[i] == "Fall"){
    Pre.Bio.Data$Term[i] <- paste(this.year,"/","FA",sep = "")
  }
  if(Pre.Bio.Data$Term[i] == "Spring"){
    flip <- sample(0:1)
    if(flip == 0){
      Pre.Bio.Data$Term[i] <- paste(this.year,"/","WI",sep = "")
    }
    if(flip == 1){
    Pre.Bio.Data$Term[i] <- paste(this.year,"/","SU",sep = "")
    }
  }
}
rename(Pre.Bio.Data, Semester = Term, `Student Random ID` = Unique_Student_ID, `Faculty Random ID` = Unique_Instructor_ID, )


```

```{r}
Bio.Data <- data.frame(`Student Random ID` = Pre.Bio.Data$Unique_Student_ID, `Course Code` = Pre.Bio.Data$COURSE_NUMBER, `Grade` = Pre.Bio.Data$Grade, `Faculty Random ID` = Pre.Bio.Data$Unique_Instructor_ID,  `Semester` = paste(Pre.Bio.Data$Year, "/", Pre.Bio.Data$Term, sep = ""), `GPA` = Pre.Bio.Data$GPA)


```





```{r}
n.Spring <- 0
for(i in 1:length(Gen_Data$Semester)){
  if(endsWith(Gen_Data$Semester[i],"SP")){
    n.Spring <- n.Spring + 1
  }
}
n.Spring
```






