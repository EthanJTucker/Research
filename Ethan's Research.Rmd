---
title: "Ethan's Project for Fall 2020"
author: "Ethan Tucker"
date: "June 26th, 2020"
output: html_document
---

ATTRIBUTION:
The data I use in this analysis were collected by Andrew Eckstrom of (?). Without this data none of the work that follows would have been possible. I also want to thank Professor Nordmoe for helping me with this project, from connecting me with the data set to all the helpful waychecks!

Potential error: Dataset does not distinguish between sections, so class tracker puts all sections together regardless of whether teaching quality and grade performance varied between sections.

Potential error: I can only track students \textit{once they have taken a math or chemistry course}. This is an issue for the first course analyses, because the students may have taken courses in prior terms in other departments.




```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, cache = TRUE)
```

```{r Initialize}
library(readxl)
library(tidyverse)
library(merTools)
library(lme4)
Easy_Data <- read_excel("/home/local/KNET/k16et01/Homeworks/Research/Stats Research Math, Chemistry, and Biology Grades, Selected Courses.xlsx")
Gen_Data <- read_excel("/home/local/KNET/k16et01/Homeworks/Research/Stats Research XLS.xlsx")
set.seed(1000)


Gen_Data <- Gen_Data %>%
                  filter(`Student Random ID` != 649419)
```

ISSUE WITH DATA SET: THE EASY DATA TRACKER DOES NOT DIFFERENTIATE BETWEEN TYPES OF WITHDRAWS. Email Dr. Eckstrom?
ISSUE WITH DATA SET: HARD TO DIFFERENTIATE BETWEEN DIFFERENT SECTIONS Uni



GENDATA ANALYSIS (CHEMISTRY AND MATH STUDENTS)

```{r Gen_Data Semester Numbering, cache = TRUE}
##Fix Gen_Data semester listing. We want them listed numerically from 1 to N.

Number.Semesters <- function(x) {
  x <- x %>% arrange(Semester)
  
  individual.cases <- x %>% pull(Semester)
  
  individual.cases[1]
  
    for(y in seq_along(along.with = individual.cases)){
      if(individual.cases[y] == "2010/FA"){
        individual.cases[y] <- 1}
      else if(individual.cases[y] == "2011/WI"){
        individual.cases[y] <- 2}
      else if(individual.cases[y] == "2011/SU"){
        individual.cases[y] <- 3}
      else if(individual.cases[y] == "2011/FA"){
        individual.cases[y] <- 4}
      else if(individual.cases[y] == "2012/WI"){
        individual.cases[y] <- 5}
      else if(individual.cases[y] == "2012/SU"){
        individual.cases[y] <- 6}
      else if(individual.cases[y] == "2012/FA"){
        individual.cases[y] <- 7}
      else if(individual.cases[y] == "2013/WI"){
        individual.cases[y] <- 8}
      else if(individual.cases[y] == "2013/SU"){
        individual.cases[y] <- 9}
      else if(individual.cases[y] == "2013/FA"){
        individual.cases[y] <- 10}
      else if(individual.cases[y] == "2014/WI"){
        individual.cases[y] <- 11}
      else if(individual.cases[y] == "2014/SU"){
        individual.cases[y] <- 12}
      else if(individual.cases[y] == "2014/FA"){
        individual.cases[y] <- 13}
      else if(individual.cases[y] == "2015/WI"){
        individual.cases[y] <- 14}
      else if(individual.cases[y] == "2015/SU"){
        individual.cases[y] <- 15}
      else if(individual.cases[y] == "2015/FA"){
        individual.cases[y] <- 16}
      else if(individual.cases[y] == "2016/WI"){
        individual.cases[y] <- 17}
      else if(individual.cases[y] == "2016/SU"){
        individual.cases[y] <- 18}
      else if(individual.cases[y] == "2016/FA"){
        individual.cases[y] <- 19}
      else if(individual.cases[y] == "2017/WI"){
        individual.cases[y] <- 20}
      else{stop("There was an invalid Semester name passed to Number.Semesters")}
      }
    x <- mutate(x, Total.Term = individual.cases)
    x
  }
  
Gen_Data <- Number.Semesters(Gen_Data)
```


```{r}
##Total number of professors
Profs.List <- unique(Gen_Data$`Faculty Random ID`)
(n.p <- length(Profs.List))
##Total number of students
Students.List <- unique(Gen_Data$`Student Random ID`)
(n.s <- length(Students.List))
##Total quantity of course entries
n <- length(Gen_Data$`Course Code`)
```

```{r Gen_Data.Grade.Converter} 
##This chunk creates the GPA colunmn in Gen_Data
###Following grade converter obtained and adapted from stack overflow user A5C1D2H2I1M1N2O1R2T1 on the page https://stackoverflow.com/questions/22746508/r-simplifying-code-to-convert-letter-grades-to-numeric-grades on 8/19/2020

convert_grades <- function(x) {
    if (x == "WS") {
        x <- 0
    } else if (x == "WF"){
      x <- 0
    } else if (x == "W"){
      x <- NA
    } else if (x == "WP"){
      x <- NA
    } else if (x == "A") {
        x <- 4
    } else if (x == "A-") {
        x <- 3.7
    } else if (x == "B+") {
        x <- 3.3
    } else if (x == "B") {
        x <- 3
    } else if (x == "B-") {
        x <- 2.7
    } else if (x == "C+") {
        x <- 2.3
    } else if (x == "C") {
        x <- 2
    } else if (x == "C-") {
        x <- 1.7
    } else if (x == "D+") {
        x <- 1.3
    } else if (x == "D") {
        x <- 1
    } else if (x == "D-") {
        x <- 0.7
    } else if (x == "F") {
        x <- 0
    } else {
        x <- NA
    }
  x <- as.double(x)
    return(x)
}


## Fix broken data points
for(i in 1:n){
  if(Gen_Data$Grade[i] == "@D"){
    Gen_Data$Grade[i] <- "D"
  }
  if(Gen_Data$Grade[i] == "@F"){
    Gen_Data$Grade[i] <- "F"
  }
}

##Apply Grade Converter
Ass.GPA <- Gen_Data$Grade
Ass.GPA [] <- sapply(Ass.GPA, convert_grades)
Gen_Data <- mutate(Gen_Data, "GPA Assigned" = as.numeric(Ass.GPA))
```


```{r}
## Initialize Department in Gen_Data
Gen_Data <- Gen_Data %>%
                mutate(Department = str_sub(`Course Code`, 1, 3))
```

```{r Class Tracker Mean GPA Assigned and Delta, cache=TRUE}
##This chunk creates the Class Tracker, Mean GPA, and Delta columns in Gen_Data. This can be recreated nicely with dplyr, I'll do that if I have time.

##IMPORTANT NOTE: the new Gen_Data variable Class Mean GPA is calculated with na.rm = TRUE, and therefore it is the mean gpa assigned of those students who did not withdraw or take incompletes that did not get resolved.
##Initial Conditions
f <- 1
c <- 1
cntr <- 1
prv.cntr <- 0
Gen_Data <- mutate(Gen_Data, "Class Tracker" = NA, "Class Mean GPA" = NA, "Delta" = NA)
Gen_Data <- arrange(arrange(arrange(Gen_Data,`Faculty Random ID`),Semester),`Course Code`)

while(is.na(Gen_Data$`Class Tracker`[n])){
if(cntr == 4332){
  break
}
  
Current.Course.Name <- Gen_Data$`Course Code`[f]
Current.Semester <- Gen_Data$Semester[f]
Current.Professor <- Gen_Data$`Faculty Random ID`[f]

while(cntr != prv.cntr ){

  if(Gen_Data$`Course Code`[c] == Current.Course.Name && Gen_Data$Semester[c] == Current.Semester && Gen_Data$`Faculty Random ID`[c] == Current.Professor){
    Gen_Data$`Class Tracker`[c] <- cntr
    c <- c+1
    }
  
  else{
    ##Calculate class mean GPA and individual student Delta's
    Class.GPAS <- rep(0,c-f)
    for(z in 2:(c-f)){
      Class.GPAS[z] <- as.double(Gen_Data$"GPA Assigned"[z-1+f])
    }
     class.mean.gpa <- mean(Class.GPAS, na.rm = TRUE)
    
    for(k in f:(c-1)){
      Gen_Data$`Class Mean GPA`[k] <- class.mean.gpa
      Gen_Data$`Delta`[k] <- Gen_Data$"GPA Assigned"[k] - class.mean.gpa
    }
    prv.cntr <- prv.cntr + 1
  }
}

cntr <- cntr + 1

## c-f store to vector one known number of classes
f <- c
}

##There's some jank where this doesn't do the class gpa and delta for the final Class Tracker, so below I tell R to do it manually. This is terrible coding hide your dignity. My one thought was to add a dummy row at the end of Gen_Data and delete it after the loop, because I think R is stopping the loop as soon as the final Class Tracker is assigned, and completes neither Delta nor Class Mean GPA for the final class.
```

```{r}
##Rewrite above code chunk with dplyr if time allows
```

JANK:


```{r Fix final class}
##Fix final class from jank method
f <- 139171
l <- 139228
k <- l - (f-1)
Gen_Data <- arrange(arrange(arrange(Gen_Data,`Faculty Random ID`),Semester),`Course Code`)
Class.GPAS2 <- rep(0,k)
for(i in f:l){
  Class.GPAS2[i-(f-1)] <- as.double(Gen_Data$"GPA Assigned"[i])
  Gen_Data$`Class Tracker`[i] <- 4332 ##CHANGE
}
class.mean.gpa <- mean(Class.GPAS2,na.rm = TRUE)
for(i in f:l){
  Gen_Data$`Class Mean GPA`[i] <- class.mean.gpa
  Gen_Data$Delta[i] <- Gen_Data$"GPA Assigned"[i] - class.mean.gpa
}

```

```{r Initialize Student.Term, cache = TRUE}
##Here we convert Total.Term into numeric, and create the Student.Term variable which describes a student's term progression through OCC


Gen_Data <- Gen_Data %>%
              arrange(`Student Random ID`, Total.Term) %>%
                mutate(Student.Term = 0)

student.index <- function(cntr){
  student.id <- unique(Gen_Data$`Student Random ID`)[cntr]
  student.indecies <- which(Gen_Data$`Student Random ID` == student.id)
  return(student.indecies)
}
    
student.terms <- function(index){
  total.terms <- Gen_Data$Total.Term[index]
  student.terms <- rep(0, length(total.terms))
  last.total.term <- total.terms[1]
  student.terms[1] <- 1
  
  if(length(total.terms) >=2){
  
    for(i in 2:length(total.terms)){
      if(last.total.term == total.terms[i]){
        student.terms[i] <- student.terms[i-1]
      } else{
        last.total.term <- total.terms[i]
        student.terms[i] <- student.terms[i-1] + 1
      }
  }
    
  }
  return(student.terms)
}


##Use functions to assign student terms. This algorithm is very slow - I couldn't think of a better way to do it. It works, so it's good enough.
n.s <- length(unique(Gen_Data$`Student Random ID`))
Gen_Data2 <- Gen_Data %>%
              mutate(Student.Term = 0)
i <- 1
for(i in 1:n.s){
  Gen_Data2$Student.Term[student.index(i)] <- student.terms(student.index(i))
}
```

```{r}
##Create a new data frame that tracks individual students through their years at OCC. First we need to figure out how many classes a student takes in math/chem departments by term.

N.Math.By.Term <- Gen_Data2 %>%
                      group_by(`Student Random ID`, Semester, Department) %>%
                        count()

N.Math.By.Term %>%
  filter(n > 1) %>%
    ungroup() %>%
      rename(Num.Courses = n) %>%
        group_by(Department, Num.Courses) %>%
          count()

##This dataset can be used to show that students are much more likely to take n math courses simultaneously than n chemistry courses. Additionally, it tells us we need to make a robust points tracking algorithm. Student 28108 passed two math courses AND a chemistry course simultaneously (during student.term 3), which tells us that a student can take multiple courses per semester in the same department.
```

```{r}
##Create class size variable for statistical significance tests. There are 5 courses with iffy class sizes: 861, 2636, 3894, 4234, and 3148. The first four of these have n = 1 - they are independent studies. 3148 had n = 3, I'm not sure how that happened. Doing this filtration gives n >= 7, which will allow for safe usage of the t test. Fortunately we did not need to remove almost any cases, so validity of results is basically unaffected.
Sig.Courses <- Gen_Data2 %>%
                group_by(`Course Code`,`Class Tracker`) %>%
                  count() %>%
                      mutate(class_size = n, Significant = if_else(n > 5, TRUE, FALSE)) %>%
                        dplyr::select(-n) %>%
                         filter(Significant == TRUE)

Gen_Data3 <- left_join(Sig.Courses, Gen_Data2, by = c("Class Tracker", "Course Code")) %>%
              dplyr::select(-Significant)
```

```{r Max Terms}
##Initialize Max Terms variable in Gen_Data
Max_terms <- Gen_Data3 %>%
        arrange(`Student Random ID`, Student.Term) %>%
                group_by(`Student Random ID`) %>%
                                summarise(`Class Tracker` = `Class Tracker`, max.terms = max(Student.Term),  Student.Term = Student.Term, Delta = Delta, `Course Code` = `Course Code`, `Faculty Random ID` = `Faculty Random ID`)

Gen_Data4 <- left_join(Gen_Data3, Max_terms)
```



```{r Initialize.Points.Tracker}
##Creates Points Tracker
  
Gen_Data4 %>%
  group_by(`Class Tracker`) %>% 
    summarise(Prof = head(`Faculty Random ID`, n = 1), Department = substr(head(Gen_Data4$`Course Code`, n = 1),1,3))
  
Points.Tracker <- data.frame(Prof.Type = NA, Professors = Profs.List, First.Math.Points = 0, First.Chem.Points = 0, First.Bio.Points = 0, First.Withdraw.Prop = 0,  Total.Math.Points = 0, Total.Chem.Points = 0, Total.Bio.Points = 0,  Total.Withdraw.Prop = 0, Future.Withdraw.Prop = 0, Total.Students = 0)
Points.Tracker <- arrange(Points.Tracker, `Professors`)
View(Points.Tracker)
```

```{r Course Credits}
##In order to create cumulative GPA we need to weight by credit hours. This chunk creates a credit variable for each row in Gen Data

##Found CHE-0950 credits at https://www.oaklandcc.edu/finaid/docs/fa39a_satisfactoryacademic.pdf 
##Found MAT-1045 credits at https://www.oaklandcc.edu/schedule/docs/OCC_Schedule_2017_WI.pdf
#Found MAT-1140 credits at http://dalnetarchive.org/bitstream/handle/11061/1402/2007%20Mathematics-%20Curriculum%20Review%20Self%20Study.pdf?sequence=1&isAllowed=y
Course.Credits <- tibble(`Course Code` = unique(Gen_Data4$`Course Code`),
                  `Course Credits` =  c(4, 4, 4, 4, 4, 4, 4, 3, 4, 4, 3, 4 , 4 , 3, 4, 4, 4, 4, 3, 4, 4, 5, 4) )


Gen_Data5 <- Gen_Data4 %>%
                left_join(Course.Credits, by = "Course Code")
```

```{r Cumulative GPA, warning = FALSE}
## This chunk creates the cumulative GPA variable in Gen_Data. This allows us to track our students through OCC without having such a stratified model - cumulative GPA is much less discrete than GPA Assigned.

##This first section creates the Cum.GPA variable with a simple weighted mean in a dummy dataset which will eventually be stored as Gen_Data
No_Withdraws <- Gen_Data5 %>%
                        arrange(`Student Random ID`, Student.Term) %>%
                                filter(!is.na(`GPA Assigned`)) %>%
                                        mutate(Cum.GPA = 0)
current.numerator <- 0
current.denominator <- 0
current.student <- 31
n.w <- length(No_Withdraws$`GPA Assigned`)
for(i in 1:n.w){
        if(No_Withdraws$`Student Random ID`[i] != current.student){
                current.numerator <- 0
                current.denominator <- 0
                current.student <- No_Withdraws$`Student Random ID`[i]
        }
        current.numerator <- current.numerator + No_Withdraws$`GPA Assigned`[i] * No_Withdraws$`Course Credits`[i]
        current.denominator <- current.denominator + No_Withdraws$`Course Credits`[i]
        
        No_Withdraws$Cum.GPA[i] <- current.numerator / current.denominator
                
}


Temp_Data <- Gen_Data5 %>%
                left_join(No_Withdraws) %>%
                        arrange(`Student Random ID`, Student.Term)


##This second section assigns the previous Cum.GPA to all withdraws if the student had a previous Cum.GPA. This allows for better visualization in ggplot, and better modeling with lmer.

for(i in 2:n){
        current.student <- Temp_Data$`Student Random ID`[i]
        previous.student <- Temp_Data$`Student Random ID`[i-1]
        
        if(is.na(Temp_Data$Cum.GPA[i])){
                if(current.student == previous.student){Temp_Data$Cum.GPA[i] <- Temp_Data$Cum.GPA[i-1] }
        }
}
```

```{r Initialize Cum.GPA}
##Here we store Cum.GPA into Gen_Data
Gen_Data6 <- Temp_Data
```

```{r No muli-department faculty}
## This chunk shows that there are no faculty that teach in multiple departments.
counter <- Gen_Data6 %>%
            mutate(Department = str_sub(`Course Code`, 1, 3)) %>%
              group_by(`Faculty Random ID`, Department) %>%
                count() 
length(counter$`Faculty Random ID`) - length(unique(Gen_Data6$`Faculty Random ID`))
```











Questions:

1) Does the grade assigned by first Professor predict / influence future performance in major / out of major?

Does the professor a student encounters first in a department influence future performance in department / out of department?


  As the below graph shows, it is difficult to create an inference for this question on the entire data set. Many students withdraw from their courses in the first term and thus do not receive grades - it is impossible to predict their GPA assigned in the first term. We can however measure probability of success by filtering for only those students that withdrew from courses in the first term, and those who did not. This brings us to a second issue - the data we have are only for the courses that students took in the math and chemistry departments during their stay at OCC. We cannot with any degree of certainty claim that those first recorded terms in the dataset are indeed the first terms. Student X could have taken an English course for all we know. We have implicitly filtered for: (1) students who did not for some reason attend a standard four year college, and (2) students that wished to take math and/or chemistry courses in community college.
  
```{r, warning=FALSE}
##Create plot to illustrate the inability to use all students for Q1. We must then do a filtration!
Plot.Data1 <- Gen_Data6 %>%
                group_by(`Student Random ID`) %>%
                  slice(1) %>%
                    mutate(First.Term.Withdraw = if_else(is.na(Cum.GPA), "Yes", "No")) %>%
                      dplyr::select(`Student Random ID`, First.Term.Withdraw, `Class Tracker`) %>%
                        right_join(Gen_Data6, by = c("Student Random ID"))

Plot.Data1 %>% 
    filter(`Student Random ID` <= 10^3) %>%
        ggplot(aes(x = Student.Term, y = Cum.GPA, group = factor(`Student Random ID`), color = First.Term.Withdraw)) +
        geom_point(position = position_jitter(width = 0.2, height = 0.1)) + 
        geom_smooth(method = "lm", se = FALSE) + 
        labs(x = "Student's Term", y = "Cumulative GPA", title = "Cumulative GPA by Student's Term for 178 Randomly Selected Students", color = "Did student withdraw from first course?")
```
6 out of the total 178 randomly drawn students withdrew from their first course. The GPA they were assigned in their second 
To partially answer this question, we must first filter for all students that took only one course in their first term, and took more than one term

```{r}
##Initialize number of courses per term
Course.Num <- Gen_Data6 %>%
                group_by(`Student Random ID`, Student.Term) %>%
                  count() %>%
                    right_join(Gen_Data6, by = c("Student Random ID", "Student.Term")) %>%
                      rename(Num.Courses.In.Term = n) %>%
                        filter(max.terms >= 2, Num.Courses.In.Term*Student.Term == 1)



##Initialize First Prof
Gen_Data7 <- Course.Num %>%
              mutate(First.Prof = `Faculty Random ID`) %>%
                ungroup() %>%
                  select(First.Prof, `Student Random ID`) %>%
                    right_join(Gen_Data6, by = c("Student Random ID"))
```



2) Does early exposure to mathematics predict / influence future performance in/out of major? Vice Versa?

  To partially answer this question, we can look at five subsets of students:
1) Those who had only a math course in their first term, then a math course in their second

```{r}
##First Course in department Tracker

      

  ## FIRST TEACHER MATH:   Assign math points

First.Math.Data <- Gen_Data %>%
                    arrange(`Student Random ID`, Student.Term) %>%
                      group_by(`Student Random ID`) %>% 
                        filter(Department == "MAT") %>%
                          slice(1)


  ## FIRST TEACHER MATH:   Assign chemistry points
  
  
  ## FIRST TEACHER CHEM:   Assign chem points
  
  ## FIRST TEACHER CHEM:   Assign math points
  
  
  
  
  
  ## Here I check the rest of the profs, and assign them points for OUT OF MAJOR classes.
  
  ## Here I check the rest of the profs, and assign them points for IN MAJOR classes.
  
  
  


```

```{r}


```

3) Do grades generally improve, worsen, or remain constant?



4) Do some teachers have significantly higher Withdraw rates than other professors? (p = .01)
  - Which courses have significantly higher withdraw rates?


```{r Professor Withdraw Tracker}
##Counts the proportion of withdraws per course that a professor teaches by class size. Compares to expected values.
Withdraws.Data <- Gen_Data  %>%
                    arrange(`Class Tracker`) %>%
                      group_by(`Course Code`, `Faculty Random ID`) %>%
                        filter(is.na(`GPA Assigned`)) %>%
                          count() %>%
                            arrange(`Faculty Random ID`) %>%
                              rename(n_withdraws = n)

          
Total <- Gen_Data  %>%
           arrange(`Class Tracker`) %>%
              group_by(`Course Code`, `Faculty Random ID`) %>%
                count() %>%
                  arrange(`Faculty Random ID`) %>%
                    rename(total_students = n)

Gen_Data_withdraw_prop <- length(Gen_Data$`GPA Assigned`[is.na(Gen_Data$`GPA Assigned`)])/n

Withdraws.Data <- left_join(Withdraws.Data, Total, by = c("Course Code", "Faculty Random ID")) %>%
                    mutate(observed_withdraw_prop = n_withdraws/total_students, expected_withdraws = Gen_Data_withdraw_prop*total_students)
```



```{r}
# Create models and plots of withdraws based on a couple different inputs.
Course.Code.withdraws.model <- lmer(n_withdraws ~ total_students + (1|`Course Code`), data = Withdraws.Data)
summary(Course.Code.withdraws.model)



##Visualization of effect of `Course Code` on n_withdraws using 10^3 bootstrap resamples
plotREsim(REsim(withdraws.model, n.sims = 10^3))

##plot(withdraws.model)


##Do I need the confint? Is that even useful?
withdraw.conf <- confint(withdraws.model, oldNames = FALSE, level = 0.999)


Plot.Data1 <- Withdraws.Data %>%
                group_by(`Faculty Random ID`) %>%
                  summarise(total_withdraws = sum(n_withdraws), total_students = sum(total_students)) %>%
                    arrange(`Faculty Random ID`)
##I'll go ahead and assign total withdraw points to profs right now before proceeding with graphing



Plot.Data1 %>%
  ggplot(aes(x = total_withdraws, y = total_students)) +
  geom_point(aes(color = factor(`Faculty Random ID`))) + 
  geom_smooth(color = "purple") +
  geom_smooth(method = "lm", color = "red") +
  theme(legend.position = "none") +
  labs(x = "Total withdraws", y = "Total students", title = "Total withdraws vs. total students, ")  
  
 ## geom_smooth(method = "lm", color = "red") +

##The standard errors of geom_smooth() and geom_smooth(method = "lm) overlap at almost all points, so it seems reasonable to assume that total withdraws vs total students can be validly represented by a linear model. I will do that presently.


```

```{r}
##total withdraws prop, number of students per prof
Points.Tracker <- arrange(Points.Tracker, Professors)
for(i in 1:length(Points.Tracker$Professors)){
  Points.Tracker$Total.Withdraw.Prop[i] <- Plot.Data1$total_withdraws[i]/Plot.Data1$total_students[i]
  Points.Tracker$Total.Students[i] <- Plot.Data1$total_students[i]
}
```


5) What is the mean number of different courses a prof teaches? What is the mean number of majors a prof teaches?

```{r}
Gen_Data <- Gen_Data %>%
              group_by(`Course Code`) %>%
                summarise(Course.Mean.GPA = mean(`GPA Assigned`, na.rm = TRUE)) %>%
                  right_join(Gen_Data, by = "Course Code")                    
```









WITH BIOLOGY STUDENTS



```{r}
##Integrate Biology Classes from Easy_Data to Gen_Data
n <- length(Easy_Data$Unique_Student_ID)
n.BIO <- 0
for(i in 1:n){
  if(startsWith(Easy_Data$SUBJ_CODE[i], "BIO")){
    n.BIO <- n.BIO + 1
  }
}
Rows.To.Remove <- rep(4,n)
for(i in 1:n){
  if(!startsWith(Easy_Data$SUBJ_CODE[i],"BIO")){
    Rows.To.Remove[i] <- i
  }
}

Pre.Bio.Data <- Easy_Data[-Rows.To.Remove,]

Pre.Bio.Data <- mutate(rename(Pre.Bio.Data, GPA = GRDE_CODE), Grade = NA)

##Inverse Grade Converter to normalize grade assignments with GenData

##Save non NA grade points as doubles
for(i in 1:length(Pre.Bio.Data$GPA)){
  
if(is.na(Pre.Bio.Data$GPA[i] == FALSE)){
  Pre.Bio.Data$GPA[i] <- as.double(Pre.Bio.Data$GPA[i])
}

}
   
for(i in 1:length(Pre.Bio.Data$Unique_Student_ID)){
  
  G <- Pre.Bio.Data$GPA[i]
  
  if(G == 0.5 || G == 1.5 || G == 2.5 || G == 3.5){
    G <- as.double(G)
    flip <- sample(0:1,1)
    if(flip == 0){
      G <- G - 0.1
    }
    else{
      G <- G + 0.1
    }
  }
  
  if(G >= 0 && G <= 4.1){
    G <- as.double(G)
  }
  
  if(is.character(G)){
  if(G == "I" || G == "W"){
    Pre.Bio.Data$Grade[i] <- "W" 
    Pre.Bio.Data$GPA[i] <- NA
  }
  if(G == "R" || G == "Z"){
   Pre.Bio.Data$Grade[i] <- "F"
   Pre.Bio.Data$GPA[i] <- 0
  }
    G <- NA
  }
  
  
  
  if(is.na(G)){
    
  }
  else if(G >= 3.9){
    Pre.Bio.Data$Grade[i] <- "A"
    Pre.Bio.Data$GPA[i] <- 4.0
  }
  else if(G >= 3.6){
    Pre.Bio.Data$Grade[i] <- "A-"
    Pre.Bio.Data$GPA[i] <- 3.7
  }
  else if(G >= 3.2){
    Pre.Bio.Data$Grade[i] <- "B+"
    Pre.Bio.Data$GPA[i] <- 3.3
  }
  else if(G >= 2.9){
    Pre.Bio.Data$Grade[i] <- "B"
    Pre.Bio.Data$GPA[i] <- 3.0
  }
  else if(G >= 2.6){
    Pre.Bio.Data$Grade[i] <- "B-"
    Pre.Bio.Data$GPA[i] <- 2.7
  }
  else if(G >= 2.2){
    Pre.Bio.Data$Grade[i] <- "C+"
    Pre.Bio.Data$GPA[i] <- 2.3
  }
  else if(G >= 1.9){
    Pre.Bio.Data$Grade[i] <- "C"
    Pre.Bio.Data$GPA[i] <- 2.0
  }
  else if(G >= 1.6){
    Pre.Bio.Data$Grade[i] <- "C-"
    Pre.Bio.Data$GPA[i] <- 1.7
  }
  else if(G >= 1.2){
    Pre.Bio.Data$Grade[i] <- "D+"
    Pre.Bio.Data$GPA[i] <- 1.3
  }
  else if(G >= 0.9){
    Pre.Bio.Data$Grade[i] <- "D"
    Pre.Bio.Data$GPA[i] <- 1.0
  }
  else if(G >= 0.6){
    Pre.Bio.Data$Grade[i] <- "D-"
    Pre.Bio.Data$GPA[i] <- 0.7
  }
  else{
    Pre.Bio.Data$Grade[i] <- "F"
    Pre.Bio.Data$GPA[i] <- 0.0
  }
}

```

```{r}
##Normalize Pre.Bio.Data Variables into useful object types
for(i in 1:length(Pre.Bio.Data$Unique_Student_ID)){
  Pre.Bio.Data$Unique_Student_ID[i] <- as.double(Pre.Bio.Data$Unique_Student_ID[i])
  Pre.Bio.Data$Unique_Instructor_ID[i] <- as.double(Pre.Bio.Data$Unique_Instructor_ID[i])
  Pre.Bio.Data$Year[i] <- as.double(Pre.Bio.Data$Year[i])
  Pre.Bio.Data$SUBJ_CODE[i] <- as.character(Pre.Bio.Data$SUBJ_CODE[i])
  Pre.Bio.Data$COURSE_NUMBER[i] <- as.double(Pre.Bio.Data$COURSE_NUMBER[i])
}

```
Issue with Data Set: Biology students stored seperately from math and chemistry students

```{r}

##Build Random ID assigner to normalize student and faculty naming with GenData

##Student Random ID Assigner

Pre.Bio.Data <- arrange(Pre.Bio.Data, `Unique_Student_ID`)

cntr <- 1
for(i in 1:length(Pre.Bio.Data$Unique_Student_ID)){
  
  if(i == 1){
    next.terms <- 0
    while(Pre.Bio.Data$Unique_Student_ID[i] == Pre.Bio.Data$Unique_Student_ID[i+next.terms]){
      next.terms <- next.terms + 1
    }
    next.terms <- next.terms - 1
    if((cntr %in% Gen_Data$`Student Random ID`) == FALSE){
      for(k in i: (i + next.terms)){
      Pre.Bio.Data$Unique_Student_ID[k] <- cntr
}
    }
    cntr <- cntr + 1
  }
  
    else if(Pre.Bio.Data$Unique_Student_ID[i] == Pre.Bio.Data$Unique_Student_ID[i-1]){
      ##Skips repeat student entry
      cntr <- cntr + 1
      
    }
    else{
     next.terms <- 0
      while(Pre.Bio.Data$Unique_Student_ID[i] == Pre.Bio.Data$Unique_Student_ID[i+next.terms]){
      next.terms <- next.terms + 1
    }
      next.terms <- next.terms - 1
    
       
      if((cntr %in% Gen_Data$`Student Random ID`) == FALSE){
        for(k in i: (i + next.terms)){
        Pre.Bio.Data$Unique_Student_ID[k] <- cntr
}
    }
      else{
        while(cntr %in% Gen_Data$`Student Random ID`){
        cntr <- cntr + 1
      }
        for(k in i: (i + next.terms)){
        Pre.Bio.Data$Unique_Student_ID[k] <- cntr
}
      
      }
      cntr <- cntr + 1
    }
    
  cntr < cntr + 1
}
```

```{r}

##Faculty Random ID Assigner
Pre.Bio.Data <- arrange(Pre.Bio.Data, `Unique_Instructor_ID`)

cntr <- as.double(1)
for(i in 1:length(Pre.Bio.Data$Unique_Instructor_ID)){
  
  if(i == 1){
    next.terms <- 0
    while(Pre.Bio.Data$Unique_Instructor_ID[i] == Pre.Bio.Data$Unique_Instructor_ID[i+next.terms]){
      next.terms <- next.terms + 1
    }
    next.terms <- next.terms - 1
    if((cntr %in% Gen_Data$`Faculty Random ID`) == FALSE){
      for(k in i: (i + next.terms)){
      Pre.Bio.Data$Unique_Instructor_ID[k] <- as.double(cntr)
}
    }
    cntr <- cntr + 1
  }
  
    else if(Pre.Bio.Data$Unique_Instructor_ID[i] == Pre.Bio.Data$Unique_Instructor_ID[i-1]){
      ##Skips repeat student entry
      cntr <- cntr + 1
      
    }
    else{
     next.terms <- 0
      while(Pre.Bio.Data$Unique_Instructor_ID[i] == Pre.Bio.Data$Unique_Instructor_ID[i+next.terms]){
      next.terms <- next.terms + 1
    }
      next.terms <- next.terms - 1
    
       
      if((cntr %in% Gen_Data$`Faculty Random ID`) == FALSE){
        for(k in i: (i + next.terms)){
        Pre.Bio.Data$Unique_Instructor_ID[k] <- as.double(cntr)
}
    }
      else{
        while(cntr %in% Gen_Data$`Faculty Random ID`){
        cntr <- cntr + 1
      }
        for(k in i: (i + next.terms)){
        Pre.Bio.Data$Unique_Instructor_ID[k] <- cntr
}
      
      }
      cntr <- cntr + 1
    }
    
  cntr < cntr + 1
}
```
Note: In Pre.Bio_Data, there were exactly 100 entries with term "Spring", out of 21538. There are no spring term entries for any of the chemistry nor math students in Gen_Data. In order to rectify this, I used a coin flip to split the spring term students between the winter and summer terms.
```{r}

##Term-inology converter; that's a pun :)
for(i in 1:length(Pre.Bio.Data$Term)){
  this.year <- Pre.Bio.Data$Year[i]
  if(Pre.Bio.Data$Term[i] == "Summer"){
    Pre.Bio.Data$Term[i] <- paste(this.year,"/","SU",sep = "")
  }
  if(Pre.Bio.Data$Term[i] == "Winter"){
    Pre.Bio.Data$Term[i] <- paste(this.year,"/","WI",sep = "")
  }
  if(Pre.Bio.Data$Term[i] == "Fall"){
    Pre.Bio.Data$Term[i] <- paste(this.year,"/","FA",sep = "")
  }
  if(Pre.Bio.Data$Term[i] == "Spring"){
    flip <- sample(0:1)
    if(flip == 0){
      Pre.Bio.Data$Term[i] <- paste(this.year,"/","WI",sep = "")
    }
    if(flip == 1){
    Pre.Bio.Data$Term[i] <- paste(this.year,"/","SU",sep = "")
    }
  }
}
rename(Pre.Bio.Data, Semester = Term, `Student Random ID` = Unique_Student_ID, `Faculty Random ID` = Unique_Instructor_ID, )
```

```{r}
Bio.Data <- data.frame(`Student Random ID` = Pre.Bio.Data$Unique_Student_ID, `Course Code` = Pre.Bio.Data$COURSE_NUMBER, `Grade` = Pre.Bio.Data$Grade, `Faculty Random ID` = Pre.Bio.Data$Unique_Instructor_ID,  `Semester` = paste(Pre.Bio.Data$Year, "/", Pre.Bio.Data$Term, sep = ""), `GPA` = Pre.Bio.Data$GPA)
```